# Fargate Smishing Analysis Bot

ì„œë²„ë¦¬ìŠ¤(AWS Fargate Spot) í™˜ê²½ì—ì„œ ë™ì‘í•˜ëŠ” ìŠ¤ë¯¸ì‹± ì‚¬ì´íŠ¸ ë¶„ì„ ë´‡ì…ë‹ˆë‹¤.
Playwrightì™€ Stealth í”ŒëŸ¬ê·¸ì¸ì„ ì‚¬ìš©í•˜ì—¬ íƒì§€ë¥¼ ìš°íšŒí•˜ë©°, ëŒ€ìƒ ì‚¬ì´íŠ¸ì˜ ìŠ¤í¬ë¦°ìƒ·, ì†ŒìŠ¤ ì½”ë“œ, ë„¤íŠ¸ì›Œí¬ íŒ¨í‚·(HAR), ì¿ í‚¤/ìŠ¤í† ë¦¬ì§€ ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ì—¬ S3ì— ì €ì¥í•©ë‹ˆë‹¤.

## ğŸ— AWS ì¸í”„ë¼ ìƒì„¸ êµ¬ì¡° (Infrastructure Deep Dive)

ì´ í”„ë¡œì íŠ¸ëŠ” Terraform(`main.tf`)ì„ í†µí•´ ë‹¤ìŒê³¼ ê°™ì€ AWS ë¦¬ì†ŒìŠ¤ë“¤ì„ ìœ ê¸°ì ìœ¼ë¡œ ì—°ê²°í•˜ì—¬ êµ¬ì„±ë©ë‹ˆë‹¤.

### 1. ë³´ì•ˆ & ë„¤íŠ¸ì›Œí¬ (Security & Network)
*   **Security Group (`aws_security_group`)**:
    *   ì¸ë°”ìš´ë“œ(Inbound): **ì°¨ë‹¨** (ì™¸ë¶€ ì ‘ì† ë¶ˆê°€, ë³´ì•ˆ ê°•í™”)
    *   ì•„ì›ƒë°”ìš´ë“œ(Outbound): **443(HTTPS), 80(HTTP) í—ˆìš©** (ë¶„ì„ ëŒ€ìƒ ì‚¬ì´íŠ¸ ì ‘ì† ë° S3/ECR/CloudWatch í†µì‹ ìš©)
    *   ì—­í• : ë´‡ì´ ê°ì—¼ëœ ì‚¬ì´íŠ¸ì— ì ‘ì†í•˜ì—¬ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆê²Œ ì—´ì–´ì£¼ë˜, ì™¸ë¶€ì—ì„œ ë´‡ì„ í•´í‚¹í•˜ì§€ ëª»í•˜ë„ë¡ ë§‰ìŠµë‹ˆë‹¤.

### 2. ì»´í“¨íŒ…í™˜ê²½ (Compute - ECS Fargate)
*   **ECS Cluster (`aws_ecs_cluster`)**:
    *   ì»¨í…Œì´ë„ˆê°€ ì‹¤í–‰ë  ë…¼ë¦¬ì  ê·¸ë£¹ì…ë‹ˆë‹¤.
*   **Capacity Provider**:
    *   **`FARGATE_SPOT` (100%)**: AWSì˜ ë‚¨ëŠ” ì»´í“¨íŒ… ìì›ì„ ì‚¬ìš©í•˜ì—¬ ë¹„ìš©ì„ 70% ì´ìƒ ì ˆê°í•©ë‹ˆë‹¤.

### 3. ì‘ì—… ì •ì˜ (Task Definition)
*   **Task Definition (`aws_ecs_task_definition`)**:
    *   **Container**: `application` ì»¨í…Œì´ë„ˆ í•˜ë‚˜ë§Œ ì‹¤í–‰ë©ë‹ˆë‹¤.
    *   **Image**: ECR(`aws_ecr_repository`)ì— ì €ì¥ëœ `smishing-bot:latest` ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
    *   **Resources**: 0.5 vCPU / 1GB Memory (ê°€ë²¼ìš´ ë¸Œë¼ìš°ì € êµ¬ë™ì— ìµœì í™”)
    *   **Environment Variables**: `TARGET_URL`(ë¶„ì„ ì£¼ì†Œ)ê³¼ `S3_BUCKET_NAME`ì„ ì‹¤í–‰ ì‹œì ì— ì£¼ì…ë°›ìŠµë‹ˆë‹¤.

### 4. ë°°í¬ ë° ì €ì¥ì†Œ (Deployment & Storage)
*   **ECR (`aws_ecr_repository`)**:
    *   `smishing-bot` ë„ì»¤ ì´ë¯¸ì§€ê°€ ì €ì¥ë˜ëŠ” ê³³ì…ë‹ˆë‹¤.
    *   `push.sh` ìŠ¤í¬ë¦½íŠ¸ê°€ ë¡œì»¬ì—ì„œ ë¹Œë“œëœ ì´ë¯¸ì§€ë¥¼ ì´ê³³ìœ¼ë¡œ `push` í•©ë‹ˆë‹¤.
*   **S3 Bucket (`aws_s3_bucket`)**:
    *   ë¶„ì„ ê²°ê³¼ë¬¼(ìŠ¤í¬ë¦°ìƒ·, ë¦¬í¬íŠ¸, ì†ŒìŠ¤ ë“±)ì´ ì˜êµ¬ ì €ì¥ë©ë‹ˆë‹¤.
    *   TaskëŠ” IAM Roleì„ í†µí•´ ì´ê³³ì— `PutObject` í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ê°€ì§‘ë‹ˆë‹¤.
*   **IAM Roles (`aws_iam_role`)**:
    *   **Execution Role**: ECSê°€ ì´ë¯¸ì§€ë¥¼ Pull í•˜ê³  ë¡œê·¸ë¥¼ CloudWatchì— ë‚¨ê¸¸ ê¶Œí•œ.
    *   **Task Role**: ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ ì½”ë“œê°€ S3ì— íŒŒì¼ì„ ì—…ë¡œë“œí•  ê¶Œí•œ.

---

## âš™ï¸ ì „ì²´ ë™ì‘ íë¦„ (End-to-End Workflow)

1.  **Build & Push (`make build`)**:
    *   `scripts/push.sh`ê°€ ì‹¤í–‰ë˜ì–´ Docker ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•©ë‹ˆë‹¤.
    *   AWS ECR(`aws_ecr_repository`)ë¡œ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•©ë‹ˆë‹¤.

2.  **Provisioning (`make run`)**:
    *   `run_task.sh`ê°€ `aws ecs run-task` ëª…ë ¹ì„ ë³´ëƒ…ë‹ˆë‹¤.
    *   ECSëŠ” `FARGATE_SPOT` í’€ì—ì„œ ìì›ì„ í™•ë³´í•˜ê³ , ì§€ì •ëœ **Security Group**ê³¼ **Subnet** ì•ˆì— ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤(ENI)ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

3.  **Execution (Task Start)**:
    *   ECRì—ì„œ ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì™€ ì»¨í…Œì´ë„ˆë¥¼ ë„ì›ë‹ˆë‹¤.
    *   ì´ë•Œ `TARGET_URL` í™˜ê²½ë³€ìˆ˜ê°€ ì»¨í…Œì´ë„ˆë¡œ ì „ë‹¬ë©ë‹ˆë‹¤.

4.  **Analysis & Upload**:
    *   Node.js ì•±ì´ íƒ€ê²Ÿ ì‚¬ì´íŠ¸ë¥¼ ë¶„ì„í•˜ê³ , **IAM Task Role** ê¶Œí•œì„ ì´ìš©í•´ S3 ë²„í‚·ì— ê²°ê³¼ íŒŒì¼ì„ ì§ì ‘ ì—…ë¡œë“œí•©ë‹ˆë‹¤.

5.  **Termination**:
    *   ë¶„ì„ì´ ëë‚˜ë©´ í”„ë¡œì„¸ìŠ¤ê°€ ì¢…ë£Œë˜ê³ (Exit 0), Fargate TaskëŠ” ì¦‰ì‹œ ì‚­ì œ(Stop)ë˜ì–´ ê³¼ê¸ˆì´ ì¤‘ë‹¨ë©ë‹ˆë‹¤.

## ğŸ“‚ í”„ë¡œì íŠ¸ êµ¬ì¡° (Structure)

```text
.
â”œâ”€â”€ app/                  # ì• í”Œë¦¬ì¼€ì´ì…˜ ì†ŒìŠ¤ ì½”ë“œ
â”‚   â”œâ”€â”€ Dockerfile        # ë¶„ì„ìš© ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ì •ì˜
â”‚   â”œâ”€â”€ index.js          # Playwright ë¶„ì„ ë¡œì§ (Stealth ì ìš©)
â”‚   â””â”€â”€ package.json      # Node.js ì˜ì¡´ì„±
â”œâ”€â”€ scripts/              # ìë™í™” ìŠ¤í¬ë¦½íŠ¸ ëª¨ìŒ
â”‚   â”œâ”€â”€ push.sh           # Docker ë¹Œë“œ ë° ECR ì—…ë¡œë“œ
â”‚   â”œâ”€â”€ run_task.sh       # Fargate Task ë‹¨ì¼ ì‹¤í–‰
â”‚   â”œâ”€â”€ run_with_retry.sh # ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ ì‹¤í–‰ (ìµœëŒ€ 3íšŒ)
â”‚   â”œâ”€â”€ check_status.sh   # ì‹¤í–‰ ì¤‘ì¸ íƒœìŠ¤í¬ ìƒíƒœ í™•ì¸
â”‚   â””â”€â”€ ls_results.sh     # S3 ê²°ê³¼ íŒŒì¼ í™•ì¸
â”œâ”€â”€ main.tf               # Terraform ì¸í”„ë¼ ì •ì˜
â”œâ”€â”€ Makefile              # ëª…ë ¹ì–´ ë‹¨ì¶•í‚¤ (ì—”íŠ¸ë¦¬í¬ì¸íŠ¸)
â””â”€â”€ terraform.tfvars      # (Git ì œì™¸ë¨) VPC, Subnet ë“± ë¯¼ê° ì„¤ì •
```

## ğŸš€ ì‹œì‘í•˜ê¸° (Getting Started)

### ì‚¬ì „ ìš”êµ¬ ì‚¬í•­ (Prerequisites)
*   AWS CLI (í”„ë¡œí•„ ì„¤ì • í•„ìš”: `Admin@aground5`)
*   Terraform
*   Docker Desktop
*   `make` (macOS/Linux ê¸°ë³¸ í¬í•¨)

### 1ï¸âƒ£ ì¸í”„ë¼ ë°°í¬ (Infrastructure)
AWS ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
```bash
make setup  # terraform init
make deploy # terraform apply
```

### 2ï¸âƒ£ ì´ë¯¸ì§€ ë¹Œë“œ ë° ì—…ë¡œë“œ (Build & Push)
ë¡œì»¬ì—ì„œ Docker ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê³  ECRë¡œ ì—…ë¡œë“œí•©ë‹ˆë‹¤.
ìë™ìœ¼ë¡œ `linux/amd64` ì•„í‚¤í…ì²˜ë¡œ ë¹Œë“œë˜ë©°, Fargate í˜¸í™˜ì„± ë¬¸ì œê°€ í•´ê²°ëœ ë²„ì „ì…ë‹ˆë‹¤.
```bash
make build
```

### 3ï¸âƒ£ ë¶„ì„ ì‹¤í–‰ (Run Analysis)
íŠ¹ì • URLì„ ëŒ€ìƒìœ¼ë¡œ ë¶„ì„ì„ ì‹œì‘í•©ë‹ˆë‹¤.

**ë‹¨ì¼ ì‹¤í–‰ (í•œ ë²ˆë§Œ ì‹œë„):**
```bash
make run url=http://example.com
```

**ì¬ì‹œë„ ì‹¤í–‰ (ì‹¤íŒ¨ ì‹œ ìµœëŒ€ 3íšŒ ìë™ ì¬ì‹œë„):** - **ê¶Œì¥**
```bash
make retry url=http://example.com
```

### 4ï¸âƒ£ ìƒíƒœ ë° ê²°ê³¼ í™•ì¸ (Monitor & Verify)

**ì‹¤í–‰ ìƒíƒœ í™•ì¸:**
í˜„ì¬ ì‹¤í–‰ ì¤‘ì´ê±°ë‚˜ ìµœê·¼ ì¢…ë£Œëœ íƒœìŠ¤í¬ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
```bash
make status
```

**ê²°ê³¼ í™•ì¸ (S3):**
ë¶„ì„ì´ ì™„ë£Œë˜ë©´ ê²°ê³¼ íŒŒì¼ ëª©ë¡ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.
```bash
make results
```
*   `screenshot.png`: ì ‘ì† í™”ë©´ ìŠ¤í¬ë¦°ìƒ·
*   `report.json`: ë¦¬ë””ë ‰ì…˜, ì¿ í‚¤, ì…ë ¥ í•„ë“œ ë“± ë¶„ì„ ë¦¬í¬íŠ¸
*   `network.har`: ì „ì²´ ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ ë¡œê·¸
*   `source.html`: í˜ì´ì§€ ì›ë³¸ ì†ŒìŠ¤

### 5ï¸âƒ£ ë¦¬ì†ŒìŠ¤ ì •ë¦¬ (Cleanup)
ëª¨ë“  AWS ë¦¬ì†ŒìŠ¤ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤. (S3 ë²„í‚· ë‚´ìš©ë¬¼ê³¼ ECR ì´ë¯¸ì§€ë„ ê°•ì œë¡œ ì‚­ì œë©ë‹ˆë‹¤)
```bash
make destroy
```

## ğŸ›  ë¬¸ì œ í•´ê²° (Troubleshooting)

**Q: `make status` í•´ë„ ì•„ë¬´ê²ƒë„ ì•ˆ ë‚˜ì™€ìš”.**
*   `make run` ì§í›„ì—ëŠ” `PROVISIONING` -> `PENDING` ìƒíƒœë¼ ëœ¨ëŠ” ë° 10~20ì´ˆ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
*   íƒœìŠ¤í¬ê°€ ì´ë¯¸ ì„±ê³µì ìœ¼ë¡œ ì¢…ë£Œë˜ì—ˆìœ¼ë©´ ëª©ë¡ì—ì„œ ì‚¬ë¼ì¡Œì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. `make results`ë¡œ í™•ì¸í•´ ë³´ì„¸ìš”.

**Q: `image Manifest does not contain descriptor matching platform` ì—ëŸ¬ê°€ ë– ìš”.**
*   ì´ì „ ë²„ì „ì˜ ì´ë¯¸ì§€ê°€ ë‚¨ì•„ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. `make build`ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•´ì„œ ì•„í‚¤í…ì²˜ê°€ ìˆ˜ì •ëœ(`--platform linux/amd64 --provenance=false`) ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”.

**Q: ë¡œê·¸ëŠ” ì–´ë””ì„œ ë³´ë‚˜ìš”?**
*   AWS CloudWatch Console -> Log groups -> `/ecs/smishing-analysis`ì—ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.
